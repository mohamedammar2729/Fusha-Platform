<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Fusha Platform - Redirecting...</title>
    <script>
      // Debug mode
      var DEBUG = true;
      function log(msg, data) {
        if (DEBUG && console && console.log) {
          console.log("404 REDIRECT: " + msg, data || "");
        }
      }

      // Single Page App routing for GitHub Pages
      (function () {
        log("404.html script running");

        // This gets the full pathname including the repo name
        var fullPath = window.location.pathname;
        log("Full path:", fullPath);

        // Assuming format is /{repo-name}/* for GitHub Pages
        // Extract the repo name from the path
        var pathParts = fullPath.split("/");
        var repoName = pathParts[1]; // e.g. "Fusha-Platform"
        log("Repo name:", repoName);

        // Everything after the repo name is the spa path
        var spaPath = "/" + pathParts.slice(2).join("/");
        log("SPA path to store:", spaPath);

        // Store path for the main app to pick up
        localStorage.setItem("spa-path", spaPath);

        // Redirect to the home page with a special parameter
        var redirectUrl =
          window.location.origin +
          "/" +
          repoName +
          "/?gh-redirect=" +
          encodeURIComponent(spaPath);

        log("Redirecting to:", redirectUrl);
        window.location.replace(redirectUrl);
      })();
    </script>
  </head>
  <body>
    <h2 style="text-align: center; font-family: Arial, sans-serif">
      جاري التحميل...
    </h2>
    <p style="text-align: center; font-family: Arial, sans-serif">
      إذا لم يتم إعادة التوجيه تلقائيًا،
      <a id="manual-redirect" href="/">انقر هنا</a>.
    </p>
    <script>
      // Set the manual redirect link to the home page
      document.getElementById("manual-redirect").href =
        "/" + window.location.pathname.split("/")[1];
    </script>
  </body>
</html>
